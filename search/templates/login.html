<div id="login">
  <form class="form-horizontal" id="loginform"
		onsubmit="return false;">
    {% csrf_token %}
    {% if next %}
    <input type="hidden" name="next" value="{{ next }}" />
    {% endif %}

    <h2>Please log in:</h2>

		<div id="login_msg" class="alert alert-warning" style="display: none"></div>

    <div class="form-group">
      <label class="col-sm-2 control-label" for="username">Username</label>
      <div class="col-sm-10">
        {% if username %}
        <input class="form-control" type="text" id="username" name="username" value={{ username }}>
        {% else %}
        <input class="form-control" type="text" id="username" name="username" placeholder="Username">
        {% endif %}
      </div>
    </div>

    <div class="form-group">
      <label class="col-sm-2 control-label" for="password">Password</label>
      <div class="col-sm-10">
        <input class="form-control" type="password" name="password" id="password" placeholder="Password">
      </div>
    </div>

    <div class="form-group">
      <div class="col-sm-offset-2 col-sm-10">
        <button type="button" class="btn btn-default" id="btn_login_cancel">Cancel</button>
        <button type="button" class="btn btn-default pull-right btn-primary" id="btn_login_ok">Login</button>
      </div>
      <script language="javascript" type = "text/javascript">
        function show_login(cb_success, cb_cancel){
					// Set default callbacks
					if( typeof cb_success != "function" )
						cb_success = function(){ location.reload(true); };
					if( typeof cb_cancel != "function")
						cb_cancel = function(){};

					// Set onclick event on Login button
					$('#btn_login_ok').click(function(){
							//do login
							var formdata = $('#loginform').serialize();
							var jqxhr = $.post('/login', formdata)
							jqxhr.done(function(data){
									// Hide lightbox
									$('#lightbox').hide()
									cb_success(data)
							});
							jqxhr.fail(function(jqXHR, textStatus, errorThrown){
									$('#login_msg').html(
										"Combination of username and password incorrect."
									)
									$('#login_msg').show();
									document.getElementById("password").value='';
							});
					});

					// Set onclick event on Cancel button
					$('#btn_login_cancel').click(function(){
							$('#lightbox').hide();
							cb_cancel();
					})
					// Show lightbox
					$('#lightbox').show()
				}
      </script>
    </div>
  </div>
  </form>
  {{ state }}
</div>

{# vim: set ft=htmldjango ts=2 sw=2 softtabstop=2: #}
